<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŸï¸ Mesin Undian Super Hoki!</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="undian-page">
    <div class="container">
        <h1>ğŸŸï¸ Mesin Undian Super HOKI! ğŸ†</h1>

        <div class="input-group-container">
            <div class="input-group">
                <label for="maxAngka">Total Nomor Undian:</label>
                <input type="number" id="maxAngka" min="1" value="100">
            </div>
            <div class="input-group">
                <label for="maxDraw">Berapa Kali Ambil?</label>
                <input type="number" id="maxDraw" min="1" value="10">
            </div>
        </div>

        <div id="result">-</div>

        <div class="button-group">
            <button id="drawButton" onclick="generateLotteryNumber()">
                <span>ğŸ‰ AMBIL NOMOR HOKI! ğŸ‰</span>
            </button>
            <button id="resetButton" onclick="initializeNumbers()">
                <span>ğŸ”„ Ulangi Keberuntungan!</span>
            </button>
        </div>

        <div class="numbers-container">
            <div class="numbers-box">
                <h2>Nomor Terpilih (<span id="drawCount">0</span>/<span id="maxDrawValue">10</span>):</h2>
                <div id="history" class="numbers-list"></div>
            </div>
            <div class="numbers-box">
                <h2>Nomor Tersisa:</h2>
                <div id="remaining" class="numbers-list"></div>
            </div>
        </div>
         <div class="footer">Semoga Beruntung! ğŸ¤ Dibuat oleh Kamu yang Hebat!</div>
    </div>

    <script>
        let historyNumbers = [];
        let remainingNumbers = [];
        let isDrawing = false;
        let maxTotalNumbers = 100;
        let maxAllowedDraws = 10; // Max times user can click draw
        let currentDrawCount = 0; // How many times user has clicked draw

        function initializeNumbers() {
            maxTotalNumbers = Math.max(1, parseInt(document.getElementById('maxAngka').value) || 100);
            maxAllowedDraws = Math.min(maxTotalNumbers, parseInt(document.getElementById('maxDraw').value) || Math.min(10, maxTotalNumbers));
            
            document.getElementById('maxAngka').value = maxTotalNumbers;
            document.getElementById('maxDraw').value = maxAllowedDraws;
            document.getElementById('maxDrawValue').textContent = maxAllowedDraws;
            
            historyNumbers = [];
            remainingNumbers = Array.from({length: maxTotalNumbers}, (_, i) => i + 1);
            currentDrawCount = 0;
            
            updateDisplay();
            const resultElement = document.getElementById("result");
            resultElement.textContent = "ğŸ¤";
            resultElement.classList.remove('winner-pulse');
            document.getElementById("drawButton").disabled = false;
            document.getElementById("drawButton").innerHTML = "<span>ğŸ‰ AMBIL NOMOR HOKI! ğŸ‰</span>";
        }

        function generateLotteryNumber() {
            if (isDrawing || remainingNumbers.length === 0 || currentDrawCount >= maxAllowedDraws) {
                if (remainingNumbers.length === 0) alert("Semua nomor sudah terambil!");
                else if (currentDrawCount >= maxAllowedDraws) alert("Sudah mencapai batas maksimal pengambilan!");
                return;
            }
            isDrawing = true;
            currentDrawCount++;
            
            const resultElement = document.getElementById('result');
            const drawButton = document.getElementById("drawButton");

            resultElement.innerHTML = '<div class="spinner"></div>';
            drawButton.disabled = true;
            drawButton.innerHTML = "<span>Mengocok...</span>";
            
            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * remainingNumbers.length);
                const chosenNumber = remainingNumbers.splice(randomIndex, 1)[0];
                historyNumbers.push(chosenNumber);
                
                resultElement.textContent = chosenNumber;
                resultElement.classList.add('winner-pulse');
                setTimeout(() => resultElement.classList.remove('winner-pulse'), 800); // Match CSS animation
                
                updateDisplay();
                isDrawing = false;
                
                if (remainingNumbers.length === 0 || currentDrawCount >= maxAllowedDraws) {
                    drawButton.innerHTML = "<span>âœ… Selesai!</span>";
                    // document.getElementById("drawButton").disabled = true; No, keep it enabled to show message
                    if (remainingNumbers.length === 0) {
                         alert("ğŸ¥³ Semua nomor sudah terpilih! Selamat!");
                    } else if (currentDrawCount >= maxAllowedDraws) {
                         alert("ğŸ Batas pengambilan nomor tercapai!");
                    }
                    createConfettiShower(true); // Big celebration
                } else {
                    drawButton.disabled = false;
                    drawButton.innerHTML = "<span>ğŸ‰ AMBIL NOMOR HOKI! ğŸ‰</span>";
                }
            }, 1800); // Increased timeout for more dramatic effect
        }

        function updateDisplay() {
            const historyElement = document.getElementById("history");
            const remainingElement = document.getElementById("remaining");
            
            historyElement.innerHTML = historyNumbers.map(num => 
                `<div class="number-chip">${num}</div>`
            ).reverse().join(''); // Show newest first
            
            remainingElement.innerHTML = remainingNumbers.map(num => 
                `<div class="number-chip">${num}</div>`
            ).join('');

            document.getElementById("drawCount").textContent = historyNumbers.length;
            document.getElementById("maxDrawValue").textContent = maxAllowedDraws; // Ensure this updates if maxDraw changes
        }

        function createConfettiShower(isCelebration = false) {
            const container = document.querySelector('.undian-page .container'); // Target container for better positioning
            if (!container) return;

            const numConfetti = isCelebration ? 100 : 20; // More for celebration
            const colors = ['#ffdd57', '#ff6b6b', '#4facfe', '#48cfad', '#f783ac', '#f9a825'];


            for (let i = 0; i < numConfetti; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                // Position confetti within the container bounds randomly
                const startX = Math.random() * container.offsetWidth;
                const startY = -20; // Start above the container

                confetti.style.left = startX + 'px';
                confetti.style.top = startY + 'px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.setProperty('--random-rotate-end', (Math.random() * 720 - 360) + 'deg');
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's'; // 2-4 seconds fall time
                confetti.style.animationDelay = (Math.random() * 1) + 's'; // Stagger start times
                
                container.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 4000); // Remove after animation
            }
        }
        
        // Event listeners for input changes
        document.getElementById("maxAngka").addEventListener("change", () => {
            const currentMax = parseInt(document.getElementById('maxAngka').value);
            const currentDraws = historyNumbers.length;
            if (currentDraws > 0 && confirm("Mengubah total nomor akan mereset undian yang sedang berjalan. Lanjutkan?")) {
                initializeNumbers();
            } else if (currentDraws === 0) {
                 initializeNumbers(); // If no draws yet, just re-init
            }
            else {
                document.getElementById("maxAngka").value = maxTotalNumbers; // Revert if cancelled
            }
        });

        document.getElementById("maxDraw").addEventListener("change", () => {
            const newMaxDraw = parseInt(document.getElementById('maxDraw').value);
            const totalNumbers = parseInt(document.getElementById('maxAngka').value);
            
            if (newMaxDraw > totalNumbers) {
                alert("Maksimal pengambilan tidak boleh melebihi total nomor undian!");
                document.getElementById('maxDraw').value = Math.min(maxAllowedDraws, totalNumbers); // Revert to old valid or new valid
                return;
            }
            if (historyNumbers.length > 0 && confirm("Mengubah maksimal pengambilan akan mereset undian. Lanjutkan?")){
                 initializeNumbers();
            } else if (historyNumbers.length === 0) {
                 initializeNumbers();
            }
             else {
                document.getElementById('maxDraw').value = maxAllowedDraws; // Revert if cancelled
            }
        });

        // Initialize on load
        initializeNumbers();
    </script>
</body>
</html>