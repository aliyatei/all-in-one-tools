<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Undian</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="undian-page">
    <div class="container">
        <h1>Generator Nomor Undian</h1>

        <div class="input-group-container">
            <div class="input-group">
                <label for="maxAngka">Total Nomor Undian:</label>
                <input type="number" id="maxAngka" min="1" value="100">
            </div>
            <div class="input-group">
                <label for="maxDraw">Jumlah Pengambilan:</label>
                <input type="number" id="maxDraw" min="1" value="10">
            </div>
        </div>

        <div id="result">-</div>

        <div class="button-group">
            <button id="drawButton" onclick="generateLotteryNumber()">
                <span>Ambil Nomor</span>
            </button>
            <button id="resetButton" onclick="initializeNumbers()">
                <span>Reset Undian</span>
            </button>
        </div>

        <div class="numbers-container">
            <div class="numbers-box">
                <h2>Nomor Terambil (<span id="drawCount">0</span>/<span id="maxDrawValue">10</span>):</h2>
                <div id="history" class="numbers-list"></div>
            </div>
            <div class="numbers-box">
                <h2>Nomor Tersisa:</h2>
                <div id="remaining" class="numbers-list"></div>
            </div>
        </div>
         <div class="footer">Utilitas Generator Undian</div>
    </div>

    <script>
        let historyNumbers = [];
        let remainingNumbers = [];
        let isDrawing = false;
        let maxTotalNumbers = 100;
        let maxAllowedDraws = 10;
        let currentDrawCount = 0;

        function initializeNumbers() {
            maxTotalNumbers = Math.max(1, parseInt(document.getElementById('maxAngka').value) || 100);
            maxAllowedDraws = Math.min(maxTotalNumbers, parseInt(document.getElementById('maxDraw').value) || Math.min(10, maxTotalNumbers));

            document.getElementById('maxAngka').value = maxTotalNumbers;
            document.getElementById('maxDraw').value = maxAllowedDraws;
            document.getElementById('maxDrawValue').textContent = maxAllowedDraws;

            historyNumbers = [];
            remainingNumbers = Array.from({length: maxTotalNumbers}, (_, i) => i + 1);
            currentDrawCount = 0;

            updateDisplay();
            const resultElement = document.getElementById("result");
            resultElement.textContent = "-";
            resultElement.classList.remove('is-rolling', 'is-revealing'); // Remove animation classes
            document.getElementById("drawButton").disabled = false;
            document.getElementById("drawButton").innerHTML = "<span>Ambil Nomor</span>";
        }

        function generateLotteryNumber() {
            if (isDrawing || remainingNumbers.length === 0 || currentDrawCount >= maxAllowedDraws) {
                if (remainingNumbers.length === 0) alert("Semua nomor telah terambil.");
                else if (currentDrawCount >= maxAllowedDraws) alert("Telah mencapai batas maksimal pengambilan.");
                return;
            }
            isDrawing = true;
            currentDrawCount++;

            const resultElement = document.getElementById('result');
            const drawButton = document.getElementById("drawButton");

            resultElement.textContent = ''; // Clear previous result
            resultElement.classList.add('is-rolling'); // Start rolling animation
            drawButton.disabled = true;
            drawButton.innerHTML = "<span>Memproses...</span>";

            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * remainingNumbers.length);
                const chosenNumber = remainingNumbers.splice(randomIndex, 1)[0];
                historyNumbers.push(chosenNumber);

                resultElement.classList.remove('is-rolling'); // Stop rolling
                resultElement.textContent = chosenNumber;
                resultElement.classList.add('is-revealing'); // Start reveal animation
                setTimeout(() => resultElement.classList.remove('is-revealing'), 300); // Remove reveal class

                updateDisplay();
                isDrawing = false;

                if (remainingNumbers.length === 0 || currentDrawCount >= maxAllowedDraws) {
                    drawButton.innerHTML = "<span>Selesai</span>";
                    if (remainingNumbers.length === 0) {
                         alert("Semua nomor telah terpilih.");
                    } else if (currentDrawCount >= maxAllowedDraws) {
                         alert("Batas pengambilan nomor telah tercapai.");
                    }
                } else {
                    drawButton.disabled = false;
                    drawButton.innerHTML = "<span>Ambil Nomor</span>";
                }
            }, 1500); // Adjust timeout to match animation duration if needed
        }

        function updateDisplay() {
            const historyElement = document.getElementById("history");
            const remainingElement = document.getElementById("remaining");

            historyElement.innerHTML = historyNumbers.map(num =>
                `<div class="number-chip">${num}</div>`
            ).reverse().join('');

            remainingElement.innerHTML = remainingNumbers.map(num =>
                `<div class="number-chip">${num}</div>`
            ).join('');

            document.getElementById("drawCount").textContent = historyNumbers.length;
            document.getElementById("maxDrawValue").textContent = maxAllowedDraws;
        }

        document.getElementById("maxAngka").addEventListener("change", () => {
            const currentDraws = historyNumbers.length;
            if (currentDraws > 0 && confirm("Mengubah total nomor akan mereset undian yang sedang berjalan. Lanjutkan?")) {
                initializeNumbers();
            } else if (currentDraws === 0) {
                 initializeNumbers();
            } else {
                document.getElementById("maxAngka").value = maxTotalNumbers;
            }
        });

        document.getElementById("maxDraw").addEventListener("change", () => {
            const newMaxDraw = parseInt(document.getElementById('maxDraw').value);
            const totalNumbers = parseInt(document.getElementById('maxAngka').value);

            if (newMaxDraw > totalNumbers) {
                alert("Maksimal pengambilan tidak boleh melebihi total nomor undian.");
                document.getElementById('maxDraw').value = Math.min(maxAllowedDraws, totalNumbers);
                return;
            }
            if (historyNumbers.length > 0 && confirm("Mengubah maksimal pengambilan akan mereset undian. Lanjutkan?")){
                 initializeNumbers();
            } else if (historyNumbers.length === 0) {
                 initializeNumbers();
            } else {
                document.getElementById('maxDraw').value = maxAllowedDraws;
            }
        });

        initializeNumbers();
    </script>
</body>
</html>